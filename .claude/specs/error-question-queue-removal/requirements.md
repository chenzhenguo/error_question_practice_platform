# 移除与加入新错题机制（Requirements）

## 简介
本功能旨在建立“错题生命周期”管理机制：当用户产生新错题时自动入队并记录时间；旧错题按照一定策略轮训出题；当某题在错题练习中连续答对 3 次后，进入“待移除”队列并在隔一周期抽查后最终移除。该机制提高错题复习的有效性，避免长久堆积，同时防止误判导致过早移除。

## 需求列表

1. 新错题入队与时间记录
   - 用户故事：作为一名学习者，我希望每次出现错误时系统自动将该题加入错题队列并记录错误时间，以便后续复盘和练习时能优先复习这些错题。
   - 验收标准（EARS）：
     1. 当用户在任意练习模式中提交错误答案时，系统应将该题加入错题队列（若已存在则更新其错误统计）。
     2. 当错题入队或错误次数更新时，系统应记录并更新该题的 `lastErrorTime` 为当前时间，并在错题历史中追加一次时间记录。
     3. 当导入/编辑导致题目内容变化时，系统应保留既有错题时间记录（除非用户明确清空）。

2. 旧错题自动轮训与抽取策略
   - 用户故事：作为一名学习者，我希望系统对旧错题进行自动轮训，让我能周期性地复习已错误过的题目，而不是只看到最新错题。
   - 验收标准（EARS）：
     1. 在错题练习模式下，系统应根据“最近错误时间、错误次数、是否未做题优先”等策略对错题进行排序与抽取。
     2. 当存在“仅显示未做题目”的优先级设置时，系统应排除已做过的错题，仅抽取未做的错题。
     3. 当存在“优先显示未做题目”的设置时，系统应在排序时提高未做题目的权重，但不排除已做题目。
     4. 在无任何筛选限制时，系统应以轮训（FIFO + 近期权重）方式抽取错题，确保旧错题能够被周期性复习。

3. 连续答对计数与进入“待移除”队列
   - 用户故事：作为一名学习者，我希望当某道错题连续答对 3 次时，它被标记为“待移除”，以减少重复练习已经掌握的题目。
   - 验收标准（EARS）：
     1. 当用户在错题练习中提交正确答案时，系统应增加该题的“连续答对计数”。
     2. 当“连续答对计数”达到 3 次时，系统应将该题从“错题队列”移入“待移除队列”，并记录该转移时间。
     3. 当题目再次答错时（在任意模式下），系统应将“连续答对计数”清零，并将其重新移回“错题队列”。
     4. 当题目处于“待移除队列”时，系统应默认不在普通错题练习中抽取该题（除抽查周期）。

4. 隔一周期抽查与最终移除
   - 用户故事：作为一名学习者，我希望在题目进入“待移除队列”后，系统隔一周期进行抽查；若抽查仍答对，则最终移除该题，避免过早删除。
   - 验收标准（EARS）：
     1. 当题目进入“待移除队列”时，系统应在下一个抽查周期对其进行抽取（周期定义可配置）。
     2. 当抽查周期触发时，系统应从“待移除队列”抽取题目进行验证，并在错题练习或专门抽查模式中呈现。
     3. 当抽查仍答对时，系统应将该题从错题系统中最终移除（不再出现在错题本与错题练习抽取集中）。
     4. 当抽查答错时，系统应将该题移回“错题队列”，连续答对计数清零，并记录最新错误时间。

5. 错题整合与队列维护
   - 用户故事：作为一名学习者，我希望在每次练习结束或错题整合动作后，系统能自动将新错题入队并对旧错题进行队列维护，以便我继续进行高效复盘。
   - 验收标准（EARS）：
     1. 当练习结束或触发“错题整合”时，系统应将本次产生的错误题目批量入队或更新其错误统计与时间。
     2. 当队列维护发生时，系统应根据策略更新队列排序（近期错误优先、未做题优先、仅未做过滤等），并准备下一次抽取集。
     3. 当队列维护发生时，系统应保留“待移除队列”的题目不参与普通抽取，仅在抽查周期参与抽取。

6. 数据模型与持久化兼容
   - 用户故事：作为系统维护者，我希望错题队列、待移除队列、连续答对计数和时间记录均能持久化保存，并与现有数据结构兼容。
   - 验收标准（EARS）：
     1. 当更新错题数据时，系统应在本地存储（或 StorageUtil）中持久化 `errorQuestions`，并包含 `errorCount`、`lastErrorTime`、`correctStreak`（连续答对计数）、`status`（normal/pendingRemoval）等字段。
     2. 当保存或加载练习数据时，系统应保持与既有键（如 `errorQuestions`、`questions`）的兼容，不破坏导出/导入、批量操作模块。
     3. 当清空缓存或重置示例数据时，系统应正确初始化上述字段，确保功能可用。

7. 可视化与用户操作反馈
   - 用户故事：作为一名学习者，我希望能够直观地看到错题的状态（普通错题/待移除）以及计数与时间记录，并在需要时进行手动移除或还原操作。
   - 验收标准（EARS）：
     1. 当题目处于“待移除队列”时，系统应在错题本或练习界面以标识（如徽章或标签）显示其状态。
     2. 当用户需要查看错题详情时，系统应展示最近错误时间与连续答对计数等信息。
     3. 当用户触发手动移除或还原时，系统应进行确认提示，并正确更新队列与持久化数据（避免误删除）。

## 边界情况与技术约束（初版）
- 边界情况：
  - 导入/编辑题目导致内容变化时，是否重置计数与状态需要明确策略（默认保留历史，计数根据题目 ID 维持）。
  - 抽查周期的定义需要明确：基于时间（如 7 天）、基于练习会话、或基于出题轮次；默认可采用“下一次错题练习会话”作为周期。
  - 当题目无 `lastErrorTime`（历史数据缺失）时，时间筛选与轮训排序的处理策略（默认视为很久之前错误，低优先级但仍可进入轮训）。
- 技术约束：
  - 需与现有 `localStorage`/`StorageUtil` 的数据结构兼容，避免破坏导出/批量模块。
  - 连续答对计数与状态应与练习流程（自动下一题、背题模式）兼容，不影响正常答题体验。
- 成功标准：
  - 新错题能稳定入队并记录时间；旧错题能轮训抽取；达到 3 连对后进入待移除并在抽查中最终移除或回退。
  - 状态可视化清晰且操作安全（有确认与提示）。

## 待澄清项（建议）
- 抽查周期的具体定义与配置：
  - 方案 A：时间周期（如 7 天）；方案 B：会话周期（下一次错题练习）；方案 C：固定轮次（如每出现 N 次队列维护后抽查）。
- 连续答对计数是否限定在错题练习模式，还是在任意模式（包含随机/顺序）中答对也计入？
- 当题目被编辑（内容或选项变化）时，是否重置连续答对计数与“待移除”状态？
- 是否允许用户在“待移除队列”中手动提前抽查或直接移除？

